<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>ðŸ’Ždiamond</title>
	<style>
		ul {
			margin: 0; padding: 0;
		}
		li {
			margin: 1px;
			padding: 1px;
			display: inline-block;
			border: 1px solid grey;
			height: 50px;
			width: 150px;
		}
	</style>
	
</head>
<body>
	<main class='todo-app'>
		<ul class='todo-list' id='target'></ul>
	</main>
	
	<script src='../diamond.js'></script>
	<!--
	
	<template id='todo'><li><div class="view"><span>done</span><label>Taste JavaScript</label><button class="destroy">x</button></div><span class="edit">Create a TodoMVC template</span></li></template>
			-->
	
			<template id='todo'><li><div class="view"><span>done</span><span>Taste JavaScript</span><span class="destroy">x</span></div><span class="edit">Create a TodoMVC template</span></li></template>
	<script>
		
		function getData() {			
			var copies = 1000; // @1000 takes < 1ms to create
			console.log( `${copies} todo's` );
			var items = new Array( copies );
			var fizz = ['fizz', '', ''], buzz = ['buzz', '', '', '', ''];
			
			for( var i = 0; i < copies; i++ ){
				items[i] = { 
					name: 'This is task ' + ( fizz[ i%3 ] + buzz[ i%5 ] || i ),
					done: ( i % 4 === 0 )
				};
			}			
			return items;
		}
		
		var { $tatic, bound } = Diamond.dom;
		
		function getTemplate() {
			
			const renderer = new Diamond.Renderer();

			const t1 = bound.text( { ref: 'done' } );
			const t2 = bound.text( { ref: 'name' } );
	
			const s1 = bound( { type: 'for', ref: 'items' }, 
				renderer.compile({
					fragment: document.getElementById('todo').content.cloneNode( true ),
					bindings: [ t1, t2 ],
					getNodes ( node ) {
						var li = node.children[0];
						return [
							li.children[0].children[0].childNodes[0],
							li.children[1].childNodes[0],
						];	
					}
				})
			);

			return renderer.compile({
				fragment: $tatic([ s1.node() ]),
				bindings: [ s1 ],
				getNodes ( node ) {
					return [
						node.childNodes[0],
					];
				}
			});
		}
		
		console.time( 'render' );
		new Diamond({
			el: document.getElementById( 'target' ),
			template: getTemplate(),
			data: { items: getData() }
		});
		
		console.timeEnd( 'render' );
		
	</script>
</body>
</html>